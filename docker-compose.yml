services:
  trojan:
    image: trojangfw/trojan
    container_name: trojan
    restart: always
    network_mode: host
    volumes:
      - ./trojan_config.json:/config/config.json
      - /etc/letsencrypt:/etc/letsencrypt
  
  nginx:
    image: nginx
    container_name: nginx
    restart: always
    network_mode: "service:trojan"
    volumes:
      - ./nginx_config.conf:/etc/nginx/nginx_config.conf
      - /etc/letsencrypt:/etc/letsencrypt
      
  v2ray:
    image: v2fly/v2fly-core
    container_name: v2ray
    network_mode: host
    restart: always
    environment:
      - V2RAY_VMESS_AEAD_FORCED=false
    volumes:
      - ./v2ray_config.json:/etc/v2ray/config.json
      - /etc/letsencrypt:/etc/letsencrypt
      
    command: ["run", "-c", "/etc/v2ray/config.json"]
